-- 1. Exibir nome do agricultor com seu respectivo endereço completo
SELECT A.Nome, E.Rua, E.numero, E.UF, E.Complemento
FROM Agricultores A
INNER JOIN Endereço_agricultor E ON A.id_endereco = E.id_endereco;


-- 2. Exibir informações dos lotes com o destino da entrega
SELECT L.Numero_lote, L.Especie, E.Destinátario, E.Comprovante
FROM Lotes L
INNER JOIN Entrega E ON L.id_entrega = E.id_entrega;


-- 3. Consultar as datas de rastreio de cada lote
SELECT L.Numero_lote, L.Especie, R.Entrada, R.Saida, R.Entrega
FROM Lotes L
INNER JOIN Rastreabilidade R ON L.QR_lote = R.QR_lote;


-- 4. Mostrar produtos armazenados e seus respectivos lotes
SELECT A.id_armazem, A.Tipo_produto, A.Quantidade, L.Especie, L.Validade
FROM Armazéns A
INNER JOIN Lotes L ON A.Numero_lote = L.Numero_lote;


-- 5. Exibir movimentações de entrada e saída por armazém
SELECT M.id_armazem, M.Entrada, M.Saida, M.Saldo_armazem, A.Tipo_produto
FROM Movimentações M
INNER JOIN Armazéns A ON M.id_armazem = A.id_armazem;


-- 6. Listar produtos, espécie e destinatário da entrega
SELECT A.Tipo_produto, L.Especie, E.Destinátario
FROM Armazéns A
INNER JOIN Lotes L ON A.Numero_lote = L.Numero_lote
INNER JOIN Entrega E ON L.id_entrega = E.id_entrega;


-- 7. Mostrar agricultores e a cidade em que estão localizados
SELECT A.Nome AS Agricultor, M.Cidade, M.Estado
FROM Agricultores A
INNER JOIN Endereço_agricultor E ON A.id_endereco = E.id_endereco
INNER JOIN Municípios M ON M.id_Municipios = A.id_endereco;


-- 8. Exibir rastreamento completo de cada entrega
SELECT L.Numero_lote, R.Entrada, R.Saida, R.Entrega, E.Destinátario
FROM Lotes L
INNER JOIN Rastreabilidade R ON L.QR_lote = R.QR_lote
INNER JOIN Entrega E ON L.id_entrega = E.id_entrega;


-- 9. Exibir movimentações de cada lote em estoque
SELECT L.Numero_lote, A.Tipo_produto, M.Entrada, M.Saida, M.Saldo_armazem
FROM Armazéns A
INNER JOIN Movimentações M ON A.id_armazem = M.id_armazem
INNER JOIN Lotes L ON A.Numero_lote = L.Numero_lote;

-- 10. Exibir data prevista e status logístico de entregas
SELECT E.id_entrega, L.Data_prevista, L.Comprovante_entrega
FROM Entrega E
INNER JOIN Logística L ON E.id_entrega = L.id_ordem;

USE banco_pi;

-- 1️ View: Agricultores e seus endereços completos
CREATE OR REPLACE VIEW vw_agricultores_enderecos AS
SELECT 
    A.Nome, 
    E.Rua, 
    E.numero, 
    E.UF, 
    E.Complemento
FROM Agricultores A
INNER JOIN Endereço_agricultor E 
    ON A.id_endereco = E.id_endereco;

-- 2️ View: Lotes e informações de entrega
CREATE OR REPLACE VIEW vw_lotes_entregas AS
SELECT 
    L.Numero_lote, 
    L.Especie, 
    E.Destinátario, 
    E.Comprovante
FROM Lotes L
INNER JOIN Entrega E 
    ON L.id_entrega = E.id_entrega;

-- 3️ View: Datas de rastreabilidade por lote
CREATE OR REPLACE VIEW vw_lotes_rastreabilidade AS
SELECT 
    L.Numero_lote, 
    L.Especie, 
    R.Entrada, 
    R.Saida, 
    R.Entrega
FROM Lotes L
INNER JOIN Rastreabilidade R 
    ON L.QR_lote = R.QR_lote;

-- 4️ View: Produtos armazenados e seus lotes
CREATE OR REPLACE VIEW vw_produtos_armazenados AS
SELECT 
    A.id_armazem, 
    A.Tipo_produto, 
    A.Quantidade, 
    L.Especie, 
    L.Validade
FROM Armazéns A
INNER JOIN Lotes L 
    ON A.Numero_lote = L.Numero_lote;

-- 5️ View: Movimentações por armazém
CREATE OR REPLACE VIEW vw_movimentacoes_armazem AS
SELECT 
    M.id_armazem, 
    M.Entrada, 
    M.Saida, 
    M.Saldo_armazem, 
    A.Tipo_produto
FROM Movimentações M
INNER JOIN Armazéns A 
    ON M.id_armazem = A.id_armazem;

-- 6️ View: Produtos, espécie e destinatário da entrega
CREATE OR REPLACE VIEW vw_produtos_entregas AS
SELECT 
    A.Tipo_produto, 
    L.Especie, 
    E.Destinátario
FROM Armazéns A
INNER JOIN Lotes L 
    ON A.Numero_lote = L.Numero_lote
INNER JOIN Entrega E 
    ON L.id_entrega = E.id_entrega;

-- 7️ View: Agricultores e cidade (corrigido relacionamento)
CREATE OR REPLACE VIEW vw_agricultores_cidades AS
SELECT 
    A.Nome AS Agricultor, 
    M.Cidade, 
    M.Estado
FROM Agricultores A
INNER JOIN Endereço_agricultor E 
    ON A.id_endereco = E.id_endereco
INNER JOIN Municípios M 
    ON M.id_Municipios = E.id_endereco;

-- 8️ View: Rastreamento completo de cada entrega
CREATE OR REPLACE VIEW vw_rastreamento_entregas AS
SELECT 
    L.Numero_lote, 
    R.Entrada, 
    R.Saida, 
    R.Entrega, 
    E.Destinátario
FROM Lotes L
INNER JOIN Rastreabilidade R 
    ON L.QR_lote = R.QR_lote
INNER JOIN Entrega E 
    ON L.id_entrega = E.id_entrega;

-- 9️ View: Movimentações de lotes em estoque
CREATE OR REPLACE VIEW vw_movimentacoes_lotes AS
SELECT 
    L.Numero_lote, 
    A.Tipo_produto, 
    M.Entrada, 
    M.Saida, 
    M.Saldo_armazem
FROM Armazéns A
INNER JOIN Movimentações M 
    ON A.id_armazem = M.id_armazem
INNER JOIN Lotes L 
    ON A.Numero_lote = L.Numero_lote;

-- 10 View: Status logístico das entregas
CREATE OR REPLACE VIEW vw_status_logistica AS
SELECT 
    E.id_entrega, 
    L.Data_prevista, 
    L.Comprovante_entrega
FROM Entrega E
INNER JOIN Logística L 
    ON E.id_entrega = L.id_ordem;


